package com.example.demo.contollers;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import com.example.demo.security.CustomUserDetail;
import com.example.demo.service.KorisnikService;

import jakarta.servlet.http.HttpServletRequest;
import model.Korisnik;

@Controller
@RequestMapping("/loginController/")
public class LoginController {

    @Autowired
    private KorisnikService korisnikService;

    @GetMapping("loginStranica")
    public String prikaziLoginFormu() {
        return "loginFolder/loginStranica";
    }

    @GetMapping("preusmeriNakonLogin")
    public String getPocetnaUlogovan(HttpServletRequest request) {
        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
        Korisnik k = ((CustomUserDetail) authentication.getPrincipal()).getK(); //vraca detalje o korisniku 
        request.getSession().setAttribute("prijavljeniKorisnik", k);

        if (k.getUloga().getNaziv().equals("Zaposleni")) {
            return "zaposleni/pocetna";
        } else if (k.getUloga().getNaziv().equals("Posetilac")) {
            return "posetilac/pocetna";
        } else {
            return "prijava/login";
        }
    }
    
    
//    @PostMapping("login")
//    public String login(@RequestParam String email,
//                        @RequestParam String lozinka,
//                        HttpSession session,
//                        Model model) {
//
//        Korisnik k = korisnikService.login(email, lozinka);
//
//        if (k == null) {
//            model.addAttribute("greska", "Pogre≈°an email ili lozinka!");
//            return "loginFolder/loginStranica";
//        }
//
//        session.setAttribute("ulogovaniKorisnik", k);
//
//        if ("ADMIN".equals(k.getUloga().getNaziv())) {
//            return "administrator/administratorHome";
//        } else {
//            return "korisnik/korisnikHome";
//        }
//    }
    
    

}
